<div dir="rtl">
<h1>پاسخ مساله threading!</h1>
فرض کنید چنین برنامه‌ای داریم.
</div>

```py
a=0 <= تو خونه ۳۷ از رم
def f():
    a=a+1
f()*2 <= به یک طریقی
print(a)
```

<div dir="rtl">
اگر کد تمرین را مثلا ۱۰۰ بار اجرا کنیم، ۵۰ بار ۲ چاپ میشه ۵۰ بار ۱. دلیلش هم اینه که موقعی که تبدیل میشه به زبان assembly کلا سه خط میشه:
</div>

```py
LOAD 37,ADX به اسم‌های 1,2
ADD ADX,1 3,4
STORE ADX,37 5 5,6
```




<div dir="rtl">
اون scheduler که مثل دونه تسبیح میاد ترتیب‌بندی میکنه، دو تا برنامه با سه تا دونه تسبیح میشه ۱ تا ۶ و ترتیب ممکنه دوتا باشه:
<br>
1 -> 3 -> 2 -> 5 -> 4 -> 6
<br>
۱ میده
<br>
1 -> 3 -> 5 -> 2 -> 4 -> 6
<br>
۲ میده
<br>
برای حل این سی پی یو یه دستور بهمون میده چون با برنامه‌نویسی عادی قابل حل نیست!
<br>
به اسم دستور Wait & Lock
<br>
میگه که یه boolean بده مثلا داخل register B و داخل یک دستور میاد چک میکنه اگه B فالس بود، true میکنه و اگه true بود انقدر صبر میکنه که B آزاد بشه ( ادامه نمیده تا آزاد شه). پس برنامه جدید میشه:
</div>


```py
W&L B
LOAD 37,ADX
ADD ADX,1
STORE ADX,37
UNLOCK B
```

<div dir="rtl">
پس الان هر چقدر هم اجرا کنیم همیشه جواب ۲ هست!
<br>
چون سی پی یو داره دیتا لود می‌کنه هر چقدر هم همزمان کار انجام بدیم، بالاخره یه جا این همزمانی‌ها به هم میخوره چون همزمان نمیتونه یه خونه رو به دو تا بده!
<br>
<br>
<h1> کاری که واقعا سی پی یو میکنه! </h1>
<br>
سی پی یو یه صف درست میکنه بعد یکی لاک میکنه بقیه همه تردهای دیگه خاموش می‌شن ( از لیست scheduler حذف میشن) و بعد سی پی یو وقتی ببینه لاک باز شد بعدی رو بیدار میکنه تا آخر
<br>
یا در بعضی شرایط سی پی یو وقتی لاک باز شد یهو همه رو باز میکنه بعد scheduler یکی رو بالاخره زودتر انجام میده و بعد دوباره...
<br>
<h1>مساله!</h1>
<br>
حالا فرض کنید ۵ نفر دور میز نشستن و بینشون یک دونه چاپ‌استیک هستن چی کار کنیم بتونن غذا بخورن ( چون به تعداد نیست مثلا اول نفر ۱ غذا میخوره بعد میذاره بعد نفر دوم)
<br>
دو تا چیز میخوایم:<br>
    ۱. قفل نشن<br>
    ۲. همه بهشون غذا برسه<br>

![ ](/home/danial/School/class-10/Computer/NewAGE/Jozavat/chopstick.png  "Chopstick.png")

<div dir="rtl">
راهی برای این مساله پیدا نکردیم پس استاد به هر نفر عدد اضافه کرد، از بالا چرخشی ساعتگرد، از ۰ تا ۵. راه حل‌های مختلفی سر کلاس بچه‌ها گفتن. راهی که استاد گفت:
<br>
همه به غیر از ۰ اول راست رو بردارن بعد چپ ولی ۰ اول چپ رو برداره بعد راست!
</div>


